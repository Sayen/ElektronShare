import{u as S,r as T,c as o,o as l,a as e,b as w,d as h,e as v,w as k,f as M,g as P,h as D,i as C,F as x,j as y,k as H,l as A,t as b}from"./index-yE5qE9NP.js";import{M as $,F,a as L}from"./FileIcon-CwauXVNG.js";import{T as N}from"./TheHeader-Bkra_8yH.js";import{a as U}from"./index-B9ygI19o.js";import"./logo-CnDJ7yAA.js";const V={class:"relative"},z={key:0,class:"absolute right-0 mt-2 w-56 origin-top-right bg-white border border-gray-200 divide-y divide-gray-100 rounded-md shadow-lg outline-none z-50"},O={class:"py-1"},j={__name:"BurgerMenu",emits:["repair-push"],setup(d,{emit:u}){const s=h(!1);S();const r=()=>{s.value=!s.value},n=()=>{s.value=!1};return(a,i)=>{const m=T("router-link");return l(),o("div",V,[e("button",{onClick:r,class:"p-2 rounded-md text-gray-500 hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary"},[...i[1]||(i[1]=[e("span",{class:"sr-only"},"Open menu",-1),e("svg",{class:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1)])]),s.value?(l(),o("div",z,[i[4]||(i[4]=e("div",{class:"px-4 py-3"},[e("p",{class:"text-sm font-medium text-gray-900"},"Menu")],-1)),e("div",O,[v(m,{to:"/",onClick:n,class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},{default:k(()=>[...i[2]||(i[2]=[M("Home",-1)])]),_:1}),v(m,{to:"/admin",onClick:n,class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},{default:k(()=>[...i[3]||(i[3]=[M("Admin Login",-1)])]),_:1}),e("button",{onClick:i[0]||(i[0]=f=>{a.$emit("repair-push"),n()}),class:"w-full text-left block px-4 py-2 text-sm text-red-600 hover:bg-gray-100"}," Push-Benachrichtigungen reparieren ")])])):w("",!0)])}}},E={async subscribeUser(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return console.warn("Push messaging is not supported"),!1;try{const d=await navigator.serviceWorker.ready;if(await d.pushManager.getSubscription())return!0;const r=await(await fetch("/api/push.php?action=vapid_public_key")).json(),n=this.urlBase64ToUint8Array(r.publicKey),a=await d.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n});return console.log("User is subscribed:",a),await fetch("/api/push.php?action=subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),!0}catch(d){return console.error("Failed to subscribe the user: ",d),!1}},urlBase64ToUint8Array(d){const u="=".repeat((4-d.length%4)%4),s=(d+u).replace(/-/g,"+").replace(/_/g,"/"),r=window.atob(s),n=new Uint8Array(r.length);for(let a=0;a<r.length;++a)n[a]=r.charCodeAt(a);return n}},K={class:"min-h-screen bg-gray-50 pb-10"},R={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},W={key:0,class:"mb-6 bg-blue-50 border-l-4 border-primary p-4 rounded shadow-sm flex justify-between items-center"},I={class:"flex mb-6","aria-label":"Breadcrumb"},J={class:"flex items-center space-x-2"},q={class:"flex items-center"},G=["onClick"],Q={key:1,class:"bg-white shadow rounded-lg p-6 mb-8 prose max-w-none text-gray-700"},X=["innerHTML"],Y={class:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6"},Z=["onClick"],ee={class:"mt-2 text-sm font-medium text-gray-900 text-center truncate w-full"},te=["href"],se={class:"mt-2 text-sm font-medium text-gray-900 text-center truncate w-full"},re={key:2,class:"text-center py-12 text-gray-500"},ue={__name:"HomeView",setup(d){A();const u=h(null),s=h([]),r=h([]),n=h([]),a=h(!0),i=new $({html:!0}),m=h(!1),f=async(p=null)=>{a.value=!0;try{const c=p?{folder_id:p}:{},t=await U.get("/api/files.php",{params:c});if(t.headers["content-type"]&&t.headers["content-type"].includes("text/html"))throw new Error("API returned HTML, likely 404 or error");const g=t.data;u.value=g.current_folder,s.value=g.folders,r.value=g.files,n.value=g.breadcrumbs||[]}catch{console.warn("Using Mock Data"),p?p==1?(u.value={id:1,name:"Technische Daten",description:"Hier finden Sie alle technischen Datenblätter."},s.value=[],r.value=[{id:101,name:"Spezifikationen_2024.pdf",url:"#"}],n.value=[{id:null,name:"Home"},{id:1,name:"Technische Daten"}]):(u.value={id:2,name:"Marketing",description:""},s.value=[],r.value=[{id:201,name:"Brochure.pdf",url:"#"}],n.value=[{id:null,name:"Home"},{id:2,name:"Marketing Material"}]):(u.value={description:`# Willkommen
Dies ist das **Elektron** Download Center.`},s.value=[{id:1,name:"Technische Daten"},{id:2,name:"Marketing Material"}],r.value=[],n.value=[])}finally{a.value=!1}},B=p=>{f(p)},_=async()=>{await E.subscribeUser()?(alert("Push-Benachrichtigungen wurden aktiviert!"),m.value=!1):alert("Konnte Push-Benachrichtigungen nicht aktivieren. Bitte prüfen Sie Ihre Browser-Einstellungen.")};return P(async()=>{f(),"Notification"in window&&Notification.permission==="default"&&(m.value=!0)}),(p,c)=>(l(),o("div",K,[v(N,null,{actions:k(()=>[v(j,{onRepairPush:_})]),_:1}),e("main",R,[m.value?(l(),o("div",W,[c[1]||(c[1]=D('<div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-primary" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg></div><div class="ml-3"><p class="text-sm text-blue-700"> Bleiben Sie informiert! Aktivieren Sie Push-Benachrichtigungen für Updates. </p></div></div>',1)),e("button",{onClick:_,class:"ml-4 px-3 py-1 bg-primary text-white text-sm rounded hover:bg-primary-dark transition"},"Aktivieren")])):w("",!0),e("nav",I,[e("ol",J,[e("li",null,[e("a",{href:"#",onClick:c[0]||(c[0]=C(t=>f(null),["prevent"])),class:"text-gray-400 hover:text-gray-500"},[...c[2]||(c[2]=[e("svg",{class:"flex-shrink-0 h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"})],-1)])])]),(l(!0),o(x,null,y(n.value,t=>(l(),o("li",{key:t.id},[e("div",q,[c[3]||(c[3]=e("svg",{class:"flex-shrink-0 h-5 w-5 text-gray-300",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})],-1)),e("a",{href:"#",onClick:C(g=>f(t.id),["prevent"]),class:"ml-2 text-sm font-medium text-gray-500 hover:text-gray-700"},b(t.name),9,G)])]))),128))])]),u.value&&u.value.description?(l(),o("div",Q,[e("div",{innerHTML:H(i).render(u.value.description)},null,8,X)])):w("",!0),e("div",Y,[(l(!0),o(x,null,y(s.value,t=>(l(),o("div",{key:"folder-"+t.id,onClick:g=>B(t.id),class:"group flex flex-col items-center p-4 bg-white rounded-lg shadow hover:shadow-md cursor-pointer transition"},[v(F),e("span",ee,b(t.name),1)],8,Z))),128)),(l(!0),o(x,null,y(r.value,t=>(l(),o("div",{key:"file-"+t.id,class:"group flex flex-col items-center p-4 bg-white rounded-lg shadow hover:shadow-md transition"},[e("a",{href:t.url,target:"_blank",class:"flex flex-col items-center w-full"},[v(L),e("span",se,b(t.name),1)],8,te)]))),128))]),!a.value&&s.value.length===0&&r.value.length===0?(l(),o("div",re," Dieser Ordner ist leer. ")):w("",!0)])]))}};export{ue as default};
